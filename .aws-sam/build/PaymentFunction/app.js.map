{"version":3,"sources":["webpack://msa_lab/./src/payment/app.ts","webpack://msa_lab/./src/payment/controller/PaymentController.ts","webpack://msa_lab/./src/payment/domain/PaymentCounter.ts","webpack://msa_lab/./src/payment/domain/PaymentEvent.ts","webpack://msa_lab/./src/payment/infra/PaymentEventDDBRepository.ts","webpack://msa_lab/./src/payment/service/PaymentService.ts","webpack://msa_lab/external \"aws-sdk\"","webpack://msa_lab/webpack/bootstrap","webpack://msa_lab/webpack/startup"],"names":["response","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","__importDefault","mod","__esModule","Object","defineProperty","exports","eventHandler","PaymentController_1","AWS","config","update","region","sqs","SQS","apiVersion","ORDERQUEUEURL","process","env","OrderQueue","paymentController","default","deleteMessage","message","params","_a","QueueUrl","ReceiptHandle","err","data","lambdaHandler","event","context","JSON","stringify","console","log","_i","record","error_1","_b","Records","applyEvent","receiptHandle","succeed","PaymentService_1","paymentService","_this","orderEvent","parse","__createBinding","create","o","m","k","k2","undefined","enumerable","get","__setModuleDefault","__importStar","prototype","hasOwnProperty","docClient","DynamoDB","DocumentClient","isEmpty","keys","trim","getPaymentCount","counter","TableName","PaymentTable","Key","promise","put","Item","ReturnValues","paymentCounter","increasePaymentCount","updateCounter","err_1","UpdateExpression","ExpressionAttributeValues","Attributes","Error","debug","eventId","eventType","PaymentEventDDBRepository","save","paymentEvent","PaymentEvent_1","PaymentEventDDBRepository_1","PaymentCounter_1","PaymentService","paymentEventDDBrepository","paymentCount","paymentEventRepository","module","require","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__"],"mappings":"8DACA,IAyCIA,EAzCAC,EAAaC,MAAQA,KAAKD,WAAc,SAAUE,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,IACpF,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,IACvF,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,OAITO,KAAKR,EAAWK,GAClGH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,YAGlEO,EAAelB,MAAQA,KAAKkB,aAAgB,SAAUjB,EAASkB,GAC/D,IAAsGC,EAAGC,EAAGC,EAAGC,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAPJ,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAOK,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEZ,KAAMkB,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BP,EAAEO,OAAOC,UAAY,WAAa,OAAO/B,OAAUuB,EACvJ,SAASM,EAAKG,GAAK,OAAO,SAAUC,GAAK,OACzC,SAAcC,GACV,GAAId,EAAG,MAAM,IAAIe,UAAU,mCAC3B,KAAOX,OACH,GAAIJ,EAAI,EAAGC,IAAMC,EAAY,EAARY,EAAG,GAASb,EAAU,OAAIa,EAAG,GAAKb,EAAS,SAAOC,EAAID,EAAU,SAAMC,EAAEc,KAAKf,GAAI,GAAKA,EAAEV,SAAWW,EAAIA,EAAEc,KAAKf,EAAGa,EAAG,KAAKnB,KAAM,OAAOO,EAE3J,OADID,EAAI,EAAGC,IAAGY,EAAK,CAAS,EAARA,EAAG,GAAQZ,EAAEb,QACzByB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGZ,EAAIY,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAEhB,MAAOyB,EAAG,GAAInB,MAAM,GAChD,KAAK,EAAGS,EAAEC,QAASJ,EAAIa,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBf,GAAZA,EAAIE,EAAEG,MAAYW,OAAS,GAAKhB,EAAEA,EAAEgB,OAAS,KAAkB,IAAVJ,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAAcZ,GAAMY,EAAG,GAAKZ,EAAE,IAAMY,EAAG,GAAKZ,EAAE,IAAM,CAAEE,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIA,EAAIY,EAAI,MAC7D,GAAIZ,GAAKE,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIE,EAAEI,IAAIW,KAAKL,GAAK,MACvDZ,EAAE,IAAIE,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKf,EAAKiB,KAAKnC,EAASuB,GAC1B,MAAOZ,GAAKsB,EAAK,CAAC,EAAGtB,GAAIS,EAAI,EAAK,QAAUD,EAAIE,EAAI,EACtD,GAAY,EAARY,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEzB,MAAOyB,EAAG,GAAKA,EAAG,QAAK,EAAQnB,MAAM,GArB9BL,CAAK,CAACsB,EAAGC,OAwBzDO,EAAmBxC,MAAQA,KAAKwC,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEpC,OAAO,IACtDoC,EAAQC,kBAAe,EAEvB,IAAIC,EAAsBP,EAAgB,EAAQ,OAC9CQ,EAAM,EAAQ,MAClBA,EAAIC,OAAOC,OAAO,CAAEC,OAAQ,mBAC5B,IAAIC,EAAM,IAAIJ,EAAIK,IAAI,CAAEC,WAAY,eAChCC,EAAgBC,QAAQC,IAAIC,WAC5BC,EAAoB,IAAIZ,EAAoBa,QAmBhD,SAASC,EAAcC,GACnB,OAAO/D,EAAUC,UAAM,OAAQ,GAAQ,WACnC,IAAI+D,EACJ,OAAO7C,EAAYlB,MAAM,SAAUgE,GAa/B,OAZAD,EAAS,CACLE,SAAUV,EACVW,cAAeJ,GAEnBV,EAAIS,cAAcE,GAAQ,SAAUI,EAAKC,GACrC,OAAID,EACO9D,QAAQE,OAAO4D,GAGf9D,QAAQC,QAAQ8D,MAGxB,CAAC,SAlCpBvB,EAAQwB,cAAgB,SAAUC,EAAOC,GAAW,OAAOxE,OAAU,OAAQ,OAAQ,GAAQ,WACzF,OAAOmB,EAAYlB,MAAM,SAAUgE,GAC/B,IAEIlE,EAAW,CACP,WAAc,IACd,KAAQ0E,KAAKC,UAAU,CACnBX,QAAS,iBAIrB,MAAOK,GAEH,OADAO,QAAQC,IAAIR,GACL,CAAC,EAAcA,GAE1B,MAAO,CAAC,EAAcrE,UA6D9B+C,EAAQC,aAtCR,SAAsBwB,EAAOC,GACzB,OAAOxE,EAAUC,UAAM,OAAQ,GAAQ,WACnC,IAAI4E,EAAIZ,EAAIa,EAAQ1D,EAAM2D,EAC1B,OAAO5D,EAAYlB,MAAM,SAAU+E,GAC/B,OAAQA,EAAGtD,OACP,KAAK,EACDiD,QAAQC,IAAIL,GACZS,EAAGtD,MAAQ,EACf,KAAK,EACDsD,EAAGpD,KAAKY,KAAK,CAAC,EAAG,EAAG,CAAE,IACtBqC,EAAK,EAAGZ,EAAKM,EAAMU,QACnBD,EAAGtD,MAAQ,EACf,KAAK,EACD,OAAMmD,EAAKZ,EAAG1B,QACduC,EAASb,EAAGY,GACZzD,EAAO0D,EAAO1D,KACP,CAAC,EAAawC,EAAkBsB,WAAW9D,KAHpB,CAAC,EAAa,GAIhD,KAAK,EAED,OADA4D,EAAGrD,OACI,CAAC,EAAamC,EAAcgB,EAAOK,gBAC9C,KAAK,EACDH,EAAGrD,OACHqD,EAAGtD,MAAQ,EACf,KAAK,EAED,OADAmD,IACO,CAAC,EAAa,GACzB,KAAK,EAED,OADAL,EAAQY,QAAQ,UACT,CAAC,EAAa,GACzB,KAAK,EAGD,OAFAL,EAAUC,EAAGrD,OACb6C,EAAQY,QAAQL,GACT,CAAC,EAAa,GACzB,KAAK,EAAG,MAAO,CAAC,Y,qBCvHhC,IAAI/E,EAAaC,MAAQA,KAAKD,WAAc,SAAUE,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,IACpF,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,IACvF,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,OAITO,KAAKR,EAAWK,GAClGH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,YAGlEO,EAAelB,MAAQA,KAAKkB,aAAgB,SAAUjB,EAASkB,GAC/D,IAAsGC,EAAGC,EAAGC,EAAGC,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAPJ,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAOK,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEZ,KAAMkB,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BP,EAAEO,OAAOC,UAAY,WAAa,OAAO/B,OAAUuB,EACvJ,SAASM,EAAKG,GAAK,OAAO,SAAUC,GAAK,OACzC,SAAcC,GACV,GAAId,EAAG,MAAM,IAAIe,UAAU,mCAC3B,KAAOX,OACH,GAAIJ,EAAI,EAAGC,IAAMC,EAAY,EAARY,EAAG,GAASb,EAAU,OAAIa,EAAG,GAAKb,EAAS,SAAOC,EAAID,EAAU,SAAMC,EAAEc,KAAKf,GAAI,GAAKA,EAAEV,SAAWW,EAAIA,EAAEc,KAAKf,EAAGa,EAAG,KAAKnB,KAAM,OAAOO,EAE3J,OADID,EAAI,EAAGC,IAAGY,EAAK,CAAS,EAARA,EAAG,GAAQZ,EAAEb,QACzByB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGZ,EAAIY,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAEhB,MAAOyB,EAAG,GAAInB,MAAM,GAChD,KAAK,EAAGS,EAAEC,QAASJ,EAAIa,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBf,GAAZA,EAAIE,EAAEG,MAAYW,OAAS,GAAKhB,EAAEA,EAAEgB,OAAS,KAAkB,IAAVJ,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAAcZ,GAAMY,EAAG,GAAKZ,EAAE,IAAMY,EAAG,GAAKZ,EAAE,IAAM,CAAEE,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIA,EAAIY,EAAI,MAC7D,GAAIZ,GAAKE,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIE,EAAEI,IAAIW,KAAKL,GAAK,MACvDZ,EAAE,IAAIE,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKf,EAAKiB,KAAKnC,EAASuB,GAC1B,MAAOZ,GAAKsB,EAAK,CAAC,EAAGtB,GAAIS,EAAI,EAAK,QAAUD,EAAIE,EAAI,EACtD,GAAY,EAARY,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEzB,MAAOyB,EAAG,GAAKA,EAAG,QAAK,EAAQnB,MAAM,GArB9BL,CAAK,CAACsB,EAAGC,OAwBzDO,EAAmBxC,MAAQA,KAAKwC,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEpC,OAAO,IACtD,IAAI2E,EAAmB5C,EAAgB,EAAQ,OAoB/CK,EAAQe,QAlBJ,SAAyByB,GACrB,IAAIC,EAAQtF,UACW,IAAnBqF,IAA6BA,EAAiB,IAAID,EAAiBxB,SACvE5D,KAAKiF,WAAa,SAAUX,GAAS,OAAOvE,EAAUuF,OAAO,OAAQ,GAAQ,WACzE,IAAIC,EACJ,OAAOrE,EAAYlB,MAAM,SAAUgE,GAC/B,OAAQA,EAAGvC,OACP,KAAK,EAED,OADA8D,EAAaf,KAAKgB,MAAMlB,GACjB,CAAC,EAAatE,KAAKqF,eAAeJ,WAAWM,IACxD,KAAK,EAAG,MAAO,CAAC,EAAcvB,EAAGtC,gBAI7C1B,KAAKqF,eAAiBA,I,qBCxD9B,IAAII,EAAmBzF,MAAQA,KAAKyF,kBAAqB9C,OAAO+C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BlD,OAAOC,eAAe+C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBlG,MAAQA,KAAKkG,qBAAwBvD,OAAO+C,OAAS,SAAUC,EAAG1D,GACxFU,OAAOC,eAAe+C,EAAG,UAAW,CAAEK,YAAY,EAAMvF,MAAOwB,KAC9D,SAAS0D,EAAG1D,GACb0D,EAAW,QAAI1D,IAEfkE,EAAgBnG,MAAQA,KAAKmG,cAAiB,SAAU1D,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI3B,EAAS,GACb,GAAW,MAAP2B,EAAa,IAAK,IAAIoD,KAAKpD,EAAe,YAANoD,GAAmBlD,OAAOyD,UAAUC,eAAejE,KAAKK,EAAKoD,IAAIJ,EAAgB3E,EAAQ2B,EAAKoD,GAEtI,OADAK,EAAmBpF,EAAQ2B,GACpB3B,GAEPf,EAAaC,MAAQA,KAAKD,WAAc,SAAUE,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,IACpF,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,IACvF,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,OAITO,KAAKR,EAAWK,GAClGH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,YAGlEO,EAAelB,MAAQA,KAAKkB,aAAgB,SAAUjB,EAASkB,GAC/D,IAAsGC,EAAGC,EAAGC,EAAGC,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAPJ,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAOK,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEZ,KAAMkB,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BP,EAAEO,OAAOC,UAAY,WAAa,OAAO/B,OAAUuB,EACvJ,SAASM,EAAKG,GAAK,OAAO,SAAUC,GAAK,OACzC,SAAcC,GACV,GAAId,EAAG,MAAM,IAAIe,UAAU,mCAC3B,KAAOX,OACH,GAAIJ,EAAI,EAAGC,IAAMC,EAAY,EAARY,EAAG,GAASb,EAAU,OAAIa,EAAG,GAAKb,EAAS,SAAOC,EAAID,EAAU,SAAMC,EAAEc,KAAKf,GAAI,GAAKA,EAAEV,SAAWW,EAAIA,EAAEc,KAAKf,EAAGa,EAAG,KAAKnB,KAAM,OAAOO,EAE3J,OADID,EAAI,EAAGC,IAAGY,EAAK,CAAS,EAARA,EAAG,GAAQZ,EAAEb,QACzByB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGZ,EAAIY,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAEhB,MAAOyB,EAAG,GAAInB,MAAM,GAChD,KAAK,EAAGS,EAAEC,QAASJ,EAAIa,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBf,GAAZA,EAAIE,EAAEG,MAAYW,OAAS,GAAKhB,EAAEA,EAAEgB,OAAS,KAAkB,IAAVJ,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAAcZ,GAAMY,EAAG,GAAKZ,EAAE,IAAMY,EAAG,GAAKZ,EAAE,IAAM,CAAEE,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIA,EAAIY,EAAI,MAC7D,GAAIZ,GAAKE,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIE,EAAEI,IAAIW,KAAKL,GAAK,MACvDZ,EAAE,IAAIE,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKf,EAAKiB,KAAKnC,EAASuB,GAC1B,MAAOZ,GAAKsB,EAAK,CAAC,EAAGtB,GAAIS,EAAI,EAAK,QAAUD,EAAIE,EAAI,EACtD,GAAY,EAARY,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEzB,MAAOyB,EAAG,GAAKA,EAAG,QAAK,EAAQnB,MAAM,GArB9BL,CAAK,CAACsB,EAAGC,OAwB7DU,OAAOC,eAAeC,EAAS,aAAc,CAAEpC,OAAO,IACtD,IAAIuC,EAAMmD,EAAa,EAAQ,OAC/BnD,EAAIC,OAAOC,OAAO,CAAEC,OAAQ,mBAC5B,IAAImD,EAAY,IAAItD,EAAIuD,SAASC,eAAe,CAC5ClD,WAAY,eA8EhBT,EAAQe,QA3EJ,WACI,IAAI0B,EAAQtF,KACZA,KAAKyG,QAAU,SAAUhG,GAAS,OAAQA,SAEpB,iBAAVA,GAAoD,IAA9BkC,OAAO+D,KAAKjG,GAAO6B,QAC/B,iBAAV7B,GAA8C,IAAxBA,EAAMkG,OAAOrE,QAC/CtC,KAAK4G,gBAAkB,WAAc,OAAO7G,EAAUuF,OAAO,OAAQ,GAAQ,WACzE,IAAIvB,EAAQ8C,EACR7C,EACJ,OAAO9C,EAAYlB,MAAM,SAAU+E,GAC/B,OAAQA,EAAGtD,OACP,KAAK,EAOD,OANAsC,EAAS,CACL+C,UAAWtD,QAAQC,IAAIsD,aACvBC,IAAK,CACD,GAAM,mBAGP,CAAC,EAAaV,EAAUL,IAAIlC,GAAQkD,WAC/C,KAAK,EAGD,OAFAJ,EAAU9B,EAAGrD,OACbgD,QAAQC,IAAI,kBAAmBkC,EAAS7G,KAAKyG,QAAQI,IAChD7G,KAAKyG,QAAQI,GACX,CAAC,EAAaP,EAAUY,IAAI,CAC3BJ,UAAWtD,QAAQC,IAAIsD,aACvBI,KAAM,CACF,GAAM,iBACN,eAAkB,GAEtBC,aAAc,YACfH,WAR4B,CAAC,EAAa,GASrD,KAAK,EAED,OADAlC,EAAGrD,OACI,CAAC,EAAc,GAC1B,KAAK,EAAG,MAAO,CAAC,EAAsC,QAAvBsC,EAAK6C,EAAQM,YAAyB,IAAPnD,OAAgB,EAASA,EAAGqD,wBAItGrH,KAAKsH,qBAAuB,WAAc,OAAOvH,EAAUuF,OAAO,OAAQ,GAAQ,WAC9E,IAAIvB,EAAQwD,EAAeC,EACvBxD,EACJ,OAAO9C,EAAYlB,MAAM,SAAU+E,GAC/B,OAAQA,EAAGtD,OACP,KAAK,EACDsC,EAAS,CACL+C,UAAWtD,QAAQC,IAAIsD,aACvBC,IAAK,CACD,GAAM,kBAEVS,iBAAkB,6CAClBC,0BAA2B,CACvB,OAAQ,GAEZN,aAAc,eAElB1C,QAAQC,IAAI,mBAAoBZ,GAChCgB,EAAGtD,MAAQ,EACf,KAAK,EAED,OADAsD,EAAGpD,KAAKY,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,EAAa+D,EAAUpD,OAAOa,GAAQkD,WAClD,KAAK,EAED,OADAM,EAAgBxC,EAAGrD,OACZ,CAAC,EAAkD,QAAnCsC,EAAKuD,EAAcI,kBAA+B,IAAP3D,OAAgB,EAASA,EAAGqD,gBAClG,KAAK,EAGD,MAFAG,EAAQzC,EAAGrD,OACXgD,QAAQC,IAAI,QAAS6C,GACf,IAAII,MAAM,MACpB,KAAK,EAAG,MAAO,CAAC,WAI5BlD,QAAQmD,MAAM,8B,aCrItBlF,OAAOC,eAAeC,EAAS,aAAc,CAAEpC,OAAO,IAStDoC,EAAQe,QAPJ,SAAsB2B,GAClBvF,KAAK8H,QAAUvC,EAAWuC,QAC1B9H,KAAK+H,UAAYxC,EAAWwC,UAC5B/H,KAAKsE,MAAQiB,EAAWjB,Q,qBCLhC,IAAImB,EAAmBzF,MAAQA,KAAKyF,kBAAqB9C,OAAO+C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BlD,OAAOC,eAAe+C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBlG,MAAQA,KAAKkG,qBAAwBvD,OAAO+C,OAAS,SAAUC,EAAG1D,GACxFU,OAAOC,eAAe+C,EAAG,UAAW,CAAEK,YAAY,EAAMvF,MAAOwB,KAC9D,SAAS0D,EAAG1D,GACb0D,EAAW,QAAI1D,IAEfkE,EAAgBnG,MAAQA,KAAKmG,cAAiB,SAAU1D,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI3B,EAAS,GACb,GAAW,MAAP2B,EAAa,IAAK,IAAIoD,KAAKpD,EAAe,YAANoD,GAAmBlD,OAAOyD,UAAUC,eAAejE,KAAKK,EAAKoD,IAAIJ,EAAgB3E,EAAQ2B,EAAKoD,GAEtI,OADAK,EAAmBpF,EAAQ2B,GACpB3B,GAEPf,EAAaC,MAAQA,KAAKD,WAAc,SAAUE,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,IACpF,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,IACvF,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,OAITO,KAAKR,EAAWK,GAClGH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,YAGlEO,EAAelB,MAAQA,KAAKkB,aAAgB,SAAUjB,EAASkB,GAC/D,IAAsGC,EAAGC,EAAGC,EAAGC,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAPJ,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAOK,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEZ,KAAMkB,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BP,EAAEO,OAAOC,UAAY,WAAa,OAAO/B,OAAUuB,EACvJ,SAASM,EAAKG,GAAK,OAAO,SAAUC,GAAK,OACzC,SAAcC,GACV,GAAId,EAAG,MAAM,IAAIe,UAAU,mCAC3B,KAAOX,OACH,GAAIJ,EAAI,EAAGC,IAAMC,EAAY,EAARY,EAAG,GAASb,EAAU,OAAIa,EAAG,GAAKb,EAAS,SAAOC,EAAID,EAAU,SAAMC,EAAEc,KAAKf,GAAI,GAAKA,EAAEV,SAAWW,EAAIA,EAAEc,KAAKf,EAAGa,EAAG,KAAKnB,KAAM,OAAOO,EAE3J,OADID,EAAI,EAAGC,IAAGY,EAAK,CAAS,EAARA,EAAG,GAAQZ,EAAEb,QACzByB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGZ,EAAIY,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAEhB,MAAOyB,EAAG,GAAInB,MAAM,GAChD,KAAK,EAAGS,EAAEC,QAASJ,EAAIa,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBf,GAAZA,EAAIE,EAAEG,MAAYW,OAAS,GAAKhB,EAAEA,EAAEgB,OAAS,KAAkB,IAAVJ,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAAcZ,GAAMY,EAAG,GAAKZ,EAAE,IAAMY,EAAG,GAAKZ,EAAE,IAAM,CAAEE,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIA,EAAIY,EAAI,MAC7D,GAAIZ,GAAKE,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIE,EAAEI,IAAIW,KAAKL,GAAK,MACvDZ,EAAE,IAAIE,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKf,EAAKiB,KAAKnC,EAASuB,GAC1B,MAAOZ,GAAKsB,EAAK,CAAC,EAAGtB,GAAIS,EAAI,EAAK,QAAUD,EAAIE,EAAI,EACtD,GAAY,EAARY,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEzB,MAAOyB,EAAG,GAAKA,EAAG,QAAK,EAAQnB,MAAM,GArB9BL,CAAK,CAACsB,EAAGC,OAwB7DU,OAAOC,eAAeC,EAAS,aAAc,CAAEpC,OAAO,IACtD,IAAIuC,EAAMmD,EAAa,EAAQ,OAC/BnD,EAAIC,OAAOC,OAAO,CAAEC,OAAQ,mBAC5B,IAAImD,EAAY,IAAItD,EAAIuD,SAASC,eAAe,CAC5ClD,WAAY,eAEZ0E,EAA2C,WAC3C,SAASA,IACLtD,QAAQmD,MAAM,gCA0BlB,OAxBAG,EAA0B5B,UAAU6B,KAAO,SAAUC,GACjD,OAAOnI,EAAUC,UAAM,OAAQ,GAAQ,WACnC,IAAI+D,EACJ,OAAO7C,EAAYlB,MAAM,SAAUgE,GAC/B,OAAQA,EAAGvC,OACP,KAAK,EAWD,OAVAsC,EAAS,CACL+C,UAAWtD,QAAQC,IAAIsD,aACvBI,KAAM,CACF,GAAMe,EAAaJ,QACnB,UAAaI,EAAaH,UAC1B,MAASG,EAAa5D,OAE1B8C,aAAc,WAElB1C,QAAQC,IAAI,cAAeuD,EAAcnE,GAClC,CAAC,EAAauC,EAAUY,IAAInD,GAAQkD,WAC/C,KAAK,EAED,MAAO,CAAC,EADCjD,EAAGtC,gBAMzBsG,EA5BmC,GA8B9CnF,EAAQe,QAAUoE,G,qBC3FlB,IAAIjI,EAAaC,MAAQA,KAAKD,WAAc,SAAUE,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,IACpF,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,IACvF,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,OAITO,KAAKR,EAAWK,GAClGH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,YAGlEO,EAAelB,MAAQA,KAAKkB,aAAgB,SAAUjB,EAASkB,GAC/D,IAAsGC,EAAGC,EAAGC,EAAGC,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAPJ,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAOK,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEZ,KAAMkB,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BP,EAAEO,OAAOC,UAAY,WAAa,OAAO/B,OAAUuB,EACvJ,SAASM,EAAKG,GAAK,OAAO,SAAUC,GAAK,OACzC,SAAcC,GACV,GAAId,EAAG,MAAM,IAAIe,UAAU,mCAC3B,KAAOX,OACH,GAAIJ,EAAI,EAAGC,IAAMC,EAAY,EAARY,EAAG,GAASb,EAAU,OAAIa,EAAG,GAAKb,EAAS,SAAOC,EAAID,EAAU,SAAMC,EAAEc,KAAKf,GAAI,GAAKA,EAAEV,SAAWW,EAAIA,EAAEc,KAAKf,EAAGa,EAAG,KAAKnB,KAAM,OAAOO,EAE3J,OADID,EAAI,EAAGC,IAAGY,EAAK,CAAS,EAARA,EAAG,GAAQZ,EAAEb,QACzByB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGZ,EAAIY,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAEhB,MAAOyB,EAAG,GAAInB,MAAM,GAChD,KAAK,EAAGS,EAAEC,QAASJ,EAAIa,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBf,GAAZA,EAAIE,EAAEG,MAAYW,OAAS,GAAKhB,EAAEA,EAAEgB,OAAS,KAAkB,IAAVJ,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAAcZ,GAAMY,EAAG,GAAKZ,EAAE,IAAMY,EAAG,GAAKZ,EAAE,IAAM,CAAEE,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIA,EAAIY,EAAI,MAC7D,GAAIZ,GAAKE,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIE,EAAEI,IAAIW,KAAKL,GAAK,MACvDZ,EAAE,IAAIE,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKf,EAAKiB,KAAKnC,EAASuB,GAC1B,MAAOZ,GAAKsB,EAAK,CAAC,EAAGtB,GAAIS,EAAI,EAAK,QAAUD,EAAIE,EAAI,EACtD,GAAY,EAARY,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEzB,MAAOyB,EAAG,GAAKA,EAAG,QAAK,EAAQnB,MAAM,GArB9BL,CAAK,CAACsB,EAAGC,OAwBzDO,EAAmBxC,MAAQA,KAAKwC,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEpC,OAAO,IACtD,IAAI0H,EAAiB3F,EAAgB,EAAQ,OACzC4F,EAA8B5F,EAAgB,EAAQ,OACtD6F,EAAmB7F,EAAgB,EAAQ,OAC3C8F,EAAgC,WAChC,SAASA,EAAeC,EAA2BC,QACb,IAA9BD,IAAwCA,EAA4B,IAAIH,EAA4BxE,cACnF,IAAjB4E,IAA2BA,EAAe,IAAIH,EAAiBzE,SACnE5D,KAAKyI,uBAAyBF,EAC9BvI,KAAKqH,eAAiBmB,EAqB1B,OAnBAF,EAAelC,UAAUnB,WAAa,SAAUM,GAC5C,OAAOxF,EAAUC,UAAM,OAAQ,GAAQ,WACnC,IAAIkI,EACJ,OAAOhH,EAAYlB,MAAM,SAAUgE,GAC/B,OAAQA,EAAGvC,OACP,KAAK,EAED,OADAyG,EAAe,IAAIC,EAAevE,QAAQ2B,GACnC,CAAC,EAAavF,KAAKyI,uBAAuBR,KAAKC,IAC1D,KAAK,EAED,OADAlE,EAAGtC,OACI,CAAC,EAAa1B,KAAKqH,eAAeC,wBAC7C,KAAK,EAGD,OAFAtD,EAAGtC,OACHgD,QAAQC,IAAI,eACL,CAAC,EAActE,QAAQC,aAAQyF,YAKnDuC,EA1BwB,GA4BnCzF,EAAQe,QAAU0E,G,SCxElBI,EAAO7F,QAAU8F,QAAQ,aCCrBC,EAA2B,GCE/B,ODCA,SAASC,EAAoBC,GAE5B,GAAGF,EAAyBE,GAC3B,OAAOF,EAAyBE,GAAUjG,QAG3C,IAAI6F,EAASE,EAAyBE,GAAY,CAGjDjG,QAAS,IAOV,OAHAkG,EAAoBD,GAAU1G,KAAKsG,EAAO7F,QAAS6F,EAAQA,EAAO7F,QAASgG,GAGpEH,EAAO7F,QCjBRgG,CAAoB,O","file":"PaymentFunction/app.js","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.eventHandler = void 0;\nvar response;\nvar PaymentController_1 = __importDefault(require(\"./controller/PaymentController\"));\nvar AWS = require(\"aws-sdk\");\nAWS.config.update({ region: \"ap-northeast-2\" });\nvar sqs = new AWS.SQS({ apiVersion: \"2012-11-05\" });\nvar ORDERQUEUEURL = process.env.OrderQueue;\nvar paymentController = new PaymentController_1.default();\nexports.lambdaHandler = function (event, context) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        try {\n            // const ret = await axios(url);\n            response = {\n                'statusCode': 200,\n                'body': JSON.stringify({\n                    message: 'hello world',\n                })\n            };\n        }\n        catch (err) {\n            console.log(err);\n            return [2 /*return*/, err];\n        }\n        return [2 /*return*/, response];\n    });\n}); };\nfunction deleteMessage(message) {\n    return __awaiter(this, void 0, void 0, function () {\n        var params;\n        return __generator(this, function (_a) {\n            params = {\n                QueueUrl: ORDERQUEUEURL,\n                ReceiptHandle: message\n            };\n            sqs.deleteMessage(params, function (err, data) {\n                if (err) {\n                    return Promise.reject(err);\n                }\n                else {\n                    return Promise.resolve(data);\n                }\n            });\n            return [2 /*return*/];\n        });\n    });\n}\nfunction eventHandler(event, context) {\n    return __awaiter(this, void 0, void 0, function () {\n        var _i, _a, record, body, error_1;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    console.log(event);\n                    _b.label = 1;\n                case 1:\n                    _b.trys.push([1, 7, , 8]);\n                    _i = 0, _a = event.Records;\n                    _b.label = 2;\n                case 2:\n                    if (!(_i < _a.length)) return [3 /*break*/, 6];\n                    record = _a[_i];\n                    body = record.body;\n                    return [4 /*yield*/, paymentController.applyEvent(body)];\n                case 3:\n                    _b.sent();\n                    return [4 /*yield*/, deleteMessage(record.receiptHandle)];\n                case 4:\n                    _b.sent();\n                    _b.label = 5;\n                case 5:\n                    _i++;\n                    return [3 /*break*/, 2];\n                case 6:\n                    context.succeed(\"Finish\");\n                    return [3 /*break*/, 8];\n                case 7:\n                    error_1 = _b.sent();\n                    context.succeed(error_1);\n                    return [3 /*break*/, 8];\n                case 8: return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.eventHandler = eventHandler;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar PaymentService_1 = __importDefault(require(\"../service/PaymentService\"));\nvar OrderController = /** @class */ (function () {\n    function OrderController(paymentService) {\n        var _this = this;\n        if (paymentService === void 0) { paymentService = new PaymentService_1.default(); }\n        this.applyEvent = function (event) { return __awaiter(_this, void 0, void 0, function () {\n            var orderEvent;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        orderEvent = JSON.parse(event);\n                        return [4 /*yield*/, this.paymentService.applyEvent(orderEvent)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        }); };\n        this.paymentService = paymentService;\n    }\n    return OrderController;\n}());\nexports.default = OrderController;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar AWS = __importStar(require(\"aws-sdk\"));\nAWS.config.update({ region: \"ap-northeast-2\" });\nvar docClient = new AWS.DynamoDB.DocumentClient({\n    apiVersion: \"2012-08-10\"\n});\nvar PaymentCounter = /** @class */ (function () {\n    function PaymentCounter() {\n        var _this = this;\n        this.isEmpty = function (value) { return (value === undefined ||\n            value === null ||\n            (typeof value === 'object' && Object.keys(value).length === 0) ||\n            (typeof value === 'string' && value.trim().length === 0)); };\n        this.getPaymentCount = function () { return __awaiter(_this, void 0, void 0, function () {\n            var params, counter;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        params = {\n                            TableName: process.env.PaymentTable,\n                            Key: {\n                                \"PK\": 'PaymentCounter'\n                            }\n                        };\n                        return [4 /*yield*/, docClient.get(params).promise()];\n                    case 1:\n                        counter = _b.sent();\n                        console.log(\"COUNTER Staus :\", counter, this.isEmpty(counter));\n                        if (!this.isEmpty(counter)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, docClient.put({\n                                TableName: process.env.PaymentTable,\n                                Item: {\n                                    \"PK\": 'PaymentCounter',\n                                    \"paymentCounter\": 0,\n                                },\n                                ReturnValues: \"ALL_OLD\"\n                            }).promise()];\n                    case 2:\n                        _b.sent();\n                        return [2 /*return*/, 0];\n                    case 3: return [2 /*return*/, (_a = counter.Item) === null || _a === void 0 ? void 0 : _a.paymentCounter];\n                }\n            });\n        }); };\n        this.increasePaymentCount = function () { return __awaiter(_this, void 0, void 0, function () {\n            var params, updateCounter, err_1;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        params = {\n                            TableName: process.env.PaymentTable,\n                            Key: {\n                                \"PK\": 'PaymentCounter'\n                            },\n                            UpdateExpression: \"set paymentCounter = paymentCounter + :val\",\n                            ExpressionAttributeValues: {\n                                \":val\": 1\n                            },\n                            ReturnValues: \"UPDATED_NEW\"\n                        };\n                        console.log(\"Param increase :\", params);\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, docClient.update(params).promise()];\n                    case 2:\n                        updateCounter = _b.sent();\n                        return [2 /*return*/, (_a = updateCounter.Attributes) === null || _a === void 0 ? void 0 : _a.paymentCounter];\n                    case 3:\n                        err_1 = _b.sent();\n                        console.log(\"ERR :\", err_1);\n                        throw new Error(\"ㅠㅠ\");\n                    case 4: return [2 /*return*/];\n                }\n            });\n        }); };\n        console.debug(\"Construct PaymentCounter\");\n    }\n    return PaymentCounter;\n}());\nexports.default = PaymentCounter;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar PaymentEvent = /** @class */ (function () {\n    function PaymentEvent(orderEvent) {\n        this.eventId = orderEvent.eventId;\n        this.eventType = orderEvent.eventType;\n        this.event = orderEvent.event;\n    }\n    return PaymentEvent;\n}());\nexports.default = PaymentEvent;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar AWS = __importStar(require(\"aws-sdk\"));\nAWS.config.update({ region: \"ap-northeast-2\" });\nvar docClient = new AWS.DynamoDB.DocumentClient({\n    apiVersion: \"2012-08-10\"\n});\nvar PaymentEventDDBRepository = /** @class */ (function () {\n    function PaymentEventDDBRepository() {\n        console.debug(\"Construct OrderDDBRepository\");\n    }\n    PaymentEventDDBRepository.prototype.save = function (paymentEvent) {\n        return __awaiter(this, void 0, void 0, function () {\n            var params, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        params = {\n                            TableName: process.env.PaymentTable,\n                            Item: {\n                                \"PK\": paymentEvent.eventId,\n                                \"eventType\": paymentEvent.eventType,\n                                \"event\": paymentEvent.event\n                            },\n                            ReturnValues: \"ALL_OLD\"\n                        };\n                        console.log(\"PEDR save :\", paymentEvent, params);\n                        return [4 /*yield*/, docClient.put(params).promise()];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    return PaymentEventDDBRepository;\n}());\nexports.default = PaymentEventDDBRepository;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar PaymentEvent_1 = __importDefault(require(\"../domain/PaymentEvent\"));\nvar PaymentEventDDBRepository_1 = __importDefault(require(\"../infra/PaymentEventDDBRepository\"));\nvar PaymentCounter_1 = __importDefault(require(\"../domain/PaymentCounter\"));\nvar PaymentService = /** @class */ (function () {\n    function PaymentService(paymentEventDDBrepository, paymentCount) {\n        if (paymentEventDDBrepository === void 0) { paymentEventDDBrepository = new PaymentEventDDBRepository_1.default(); }\n        if (paymentCount === void 0) { paymentCount = new PaymentCounter_1.default(); }\n        this.paymentEventRepository = paymentEventDDBrepository;\n        this.paymentCounter = paymentCount;\n    }\n    PaymentService.prototype.applyEvent = function (orderEvent) {\n        return __awaiter(this, void 0, void 0, function () {\n            var paymentEvent;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        paymentEvent = new PaymentEvent_1.default(orderEvent);\n                        return [4 /*yield*/, this.paymentEventRepository.save(paymentEvent)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.paymentCounter.increasePaymentCount()];\n                    case 2:\n                        _a.sent();\n                        console.log(\"Apply Event\");\n                        return [2 /*return*/, Promise.resolve(undefined)];\n                }\n            });\n        });\n    };\n    return PaymentService;\n}());\nexports.default = PaymentService;\n","module.exports = require(\"aws-sdk\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(6949);\n"],"sourceRoot":""}