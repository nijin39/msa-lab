{"version":3,"sources":["webpack://msa_lab/./src/payment/app.ts","webpack://msa_lab/./src/payment/controller/PaymentController.ts","webpack://msa_lab/./src/payment/domain/PaymentCounter.ts","webpack://msa_lab/./src/payment/domain/PaymentEvent.ts","webpack://msa_lab/./src/payment/infra/PaymentEventDDBRepository.ts","webpack://msa_lab/./src/payment/service/PaymentService.ts","webpack://msa_lab/external \"aws-sdk\"","webpack://msa_lab/webpack/bootstrap","webpack://msa_lab/webpack/startup"],"names":["response","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","__importDefault","mod","__esModule","Object","defineProperty","exports","eventHandler","PaymentController_1","AWS","config","update","region","sqs","SQS","apiVersion","ORDERQUEUEURL","process","env","OrderQueue","paymentController","default","deleteMessage","message","params","_a","QueueUrl","ReceiptHandle","err","data","lambdaHandler","event","context","JSON","stringify","console","log","_i","record","error_1","_b","Records","applyEvent","receiptHandle","succeed","PaymentService_1","paymentService","_this","orderEvent","parse","__createBinding","create","o","m","k","k2","undefined","enumerable","get","__setModuleDefault","__importStar","prototype","hasOwnProperty","docClient","DynamoDB","DocumentClient","isEmpty","keys","trim","getPaymentCount","counter","TableName","PaymentTable","Key","promise","put","Item","ReturnValues","paymentCounter","increasePaymentCount","updateCounter","err_1","UpdateExpression","ExpressionAttributeValues","Attributes","Error","debug","eventId","eventType","PaymentEventDDBRepository","save","paymentEvent","PaymentEvent_1","PaymentEventDDBRepository_1","PaymentCounter_1","PaymentService","paymentEventDDBrepository","paymentCount","paymentEventRepository","module","require","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__"],"mappings":"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","file":"PaymentEventHandlerFunction/app.js","sourcesContent":["\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.eventHandler = void 0;\r\nvar response;\r\nvar PaymentController_1 = __importDefault(require(\"./controller/PaymentController\"));\r\nvar AWS = require(\"aws-sdk\");\r\nAWS.config.update({ region: \"ap-northeast-2\" });\r\nvar sqs = new AWS.SQS({ apiVersion: \"2012-11-05\" });\r\nvar ORDERQUEUEURL = process.env.OrderQueue;\r\nvar paymentController = new PaymentController_1.default();\r\nexports.lambdaHandler = function (event, context) { return __awaiter(void 0, void 0, void 0, function () {\r\n    return __generator(this, function (_a) {\r\n        try {\r\n            // const ret = await axios(url);\r\n            response = {\r\n                'statusCode': 200,\r\n                'body': JSON.stringify({\r\n                    message: 'hello world',\r\n                })\r\n            };\r\n        }\r\n        catch (err) {\r\n            console.log(err);\r\n            return [2 /*return*/, err];\r\n        }\r\n        return [2 /*return*/, response];\r\n    });\r\n}); };\r\nfunction deleteMessage(message) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var params;\r\n        return __generator(this, function (_a) {\r\n            params = {\r\n                QueueUrl: ORDERQUEUEURL,\r\n                ReceiptHandle: message\r\n            };\r\n            sqs.deleteMessage(params, function (err, data) {\r\n                if (err) {\r\n                    return Promise.reject(err);\r\n                }\r\n                else {\r\n                    return Promise.resolve(data);\r\n                }\r\n            });\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n}\r\nfunction eventHandler(event, context) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _i, _a, record, body, error_1;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    console.log(event);\r\n                    _b.label = 1;\r\n                case 1:\r\n                    _b.trys.push([1, 7, , 8]);\r\n                    _i = 0, _a = event.Records;\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(_i < _a.length)) return [3 /*break*/, 6];\r\n                    record = _a[_i];\r\n                    body = record.body;\r\n                    return [4 /*yield*/, paymentController.applyEvent(body)];\r\n                case 3:\r\n                    _b.sent();\r\n                    return [4 /*yield*/, deleteMessage(record.receiptHandle)];\r\n                case 4:\r\n                    _b.sent();\r\n                    _b.label = 5;\r\n                case 5:\r\n                    _i++;\r\n                    return [3 /*break*/, 2];\r\n                case 6:\r\n                    context.succeed(\"Finish\");\r\n                    return [3 /*break*/, 8];\r\n                case 7:\r\n                    error_1 = _b.sent();\r\n                    context.succeed(error_1);\r\n                    return [3 /*break*/, 8];\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.eventHandler = eventHandler;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar PaymentService_1 = __importDefault(require(\"../service/PaymentService\"));\r\nvar OrderController = /** @class */ (function () {\r\n    function OrderController(paymentService) {\r\n        var _this = this;\r\n        if (paymentService === void 0) { paymentService = new PaymentService_1.default(); }\r\n        this.applyEvent = function (event) { return __awaiter(_this, void 0, void 0, function () {\r\n            var orderEvent;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        orderEvent = JSON.parse(event);\r\n                        return [4 /*yield*/, this.paymentService.applyEvent(orderEvent)];\r\n                    case 1: return [2 /*return*/, _a.sent()];\r\n                }\r\n            });\r\n        }); };\r\n        this.paymentService = paymentService;\r\n    }\r\n    return OrderController;\r\n}());\r\nexports.default = OrderController;\r\n","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AWS = __importStar(require(\"aws-sdk\"));\r\nAWS.config.update({ region: \"ap-northeast-2\" });\r\nvar docClient = new AWS.DynamoDB.DocumentClient({\r\n    apiVersion: \"2012-08-10\"\r\n});\r\nvar PaymentCounter = /** @class */ (function () {\r\n    function PaymentCounter() {\r\n        var _this = this;\r\n        this.isEmpty = function (value) { return (value === undefined ||\r\n            value === null ||\r\n            (typeof value === 'object' && Object.keys(value).length === 0) ||\r\n            (typeof value === 'string' && value.trim().length === 0)); };\r\n        this.getPaymentCount = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var params, counter;\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        params = {\r\n                            TableName: process.env.PaymentTable,\r\n                            Key: {\r\n                                \"PK\": 'PaymentCounter'\r\n                            }\r\n                        };\r\n                        return [4 /*yield*/, docClient.get(params).promise()];\r\n                    case 1:\r\n                        counter = _b.sent();\r\n                        console.log(\"COUNTER Staus :\", counter, this.isEmpty(counter));\r\n                        if (!this.isEmpty(counter)) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, docClient.put({\r\n                                TableName: process.env.PaymentTable,\r\n                                Item: {\r\n                                    \"PK\": 'PaymentCounter',\r\n                                    \"paymentCounter\": 0,\r\n                                },\r\n                                ReturnValues: \"ALL_OLD\"\r\n                            }).promise()];\r\n                    case 2:\r\n                        _b.sent();\r\n                        return [2 /*return*/, 0];\r\n                    case 3: return [2 /*return*/, (_a = counter.Item) === null || _a === void 0 ? void 0 : _a.paymentCounter];\r\n                }\r\n            });\r\n        }); };\r\n        this.increasePaymentCount = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var counter, params, updateCounter, err_1;\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4 /*yield*/, this.getPaymentCount()];\r\n                    case 1:\r\n                        counter = _b.sent();\r\n                        console.log(\"COUNT INCREASE :\", counter, counter + 1);\r\n                        params = {\r\n                            TableName: process.env.PaymentTable,\r\n                            Key: {\r\n                                \"PK\": 'PaymentCounter'\r\n                            },\r\n                            UpdateExpression: \"set paymentCounter = paymentCounter + :val\",\r\n                            ExpressionAttributeValues: {\r\n                                \":val\": 1\r\n                            },\r\n                            ReturnValues: \"UPDATED_NEW\"\r\n                        };\r\n                        console.log(\"Param increase :\", params);\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        _b.trys.push([2, 4, , 5]);\r\n                        return [4 /*yield*/, docClient.update(params).promise()];\r\n                    case 3:\r\n                        updateCounter = _b.sent();\r\n                        return [2 /*return*/, (_a = updateCounter.Attributes) === null || _a === void 0 ? void 0 : _a.paymentCounter];\r\n                    case 4:\r\n                        err_1 = _b.sent();\r\n                        console.log(\"ERR :\", err_1);\r\n                        throw new Error(\"ㅠㅠ\");\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        console.debug(\"Construct PaymentCounter\");\r\n    }\r\n    return PaymentCounter;\r\n}());\r\nexports.default = PaymentCounter;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar PaymentEvent = /** @class */ (function () {\r\n    function PaymentEvent(orderEvent) {\r\n        this.eventId = orderEvent.eventId;\r\n        this.eventType = orderEvent.eventType;\r\n        this.event = orderEvent.event;\r\n    }\r\n    return PaymentEvent;\r\n}());\r\nexports.default = PaymentEvent;\r\n","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AWS = __importStar(require(\"aws-sdk\"));\r\nAWS.config.update({ region: \"ap-northeast-2\" });\r\nvar docClient = new AWS.DynamoDB.DocumentClient({\r\n    apiVersion: \"2012-08-10\"\r\n});\r\nvar PaymentEventDDBRepository = /** @class */ (function () {\r\n    function PaymentEventDDBRepository() {\r\n        console.debug(\"Construct OrderDDBRepository\");\r\n    }\r\n    PaymentEventDDBRepository.prototype.save = function (paymentEvent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var params, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        params = {\r\n                            TableName: process.env.PaymentTable,\r\n                            Item: {\r\n                                \"PK\": paymentEvent.eventId,\r\n                                \"eventType\": paymentEvent.eventType,\r\n                                \"event\": paymentEvent.event\r\n                            },\r\n                            ReturnValues: \"ALL_OLD\"\r\n                        };\r\n                        console.log(\"PEDR save :\", paymentEvent, params);\r\n                        return [4 /*yield*/, docClient.put(params).promise()];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2 /*return*/, result];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return PaymentEventDDBRepository;\r\n}());\r\nexports.default = PaymentEventDDBRepository;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar PaymentEvent_1 = __importDefault(require(\"../domain/PaymentEvent\"));\r\nvar PaymentEventDDBRepository_1 = __importDefault(require(\"../infra/PaymentEventDDBRepository\"));\r\nvar PaymentCounter_1 = __importDefault(require(\"../domain/PaymentCounter\"));\r\nvar PaymentService = /** @class */ (function () {\r\n    function PaymentService(paymentEventDDBrepository, paymentCount) {\r\n        if (paymentEventDDBrepository === void 0) { paymentEventDDBrepository = new PaymentEventDDBRepository_1.default(); }\r\n        if (paymentCount === void 0) { paymentCount = new PaymentCounter_1.default(); }\r\n        this.paymentEventRepository = paymentEventDDBrepository;\r\n        this.paymentCounter = paymentCount;\r\n    }\r\n    PaymentService.prototype.applyEvent = function (orderEvent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var paymentEvent;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        paymentEvent = new PaymentEvent_1.default(orderEvent);\r\n                        return [4 /*yield*/, this.paymentEventRepository.save(paymentEvent)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.paymentCounter.increasePaymentCount()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        console.log(\"Apply Event\");\r\n                        return [2 /*return*/, Promise.resolve(undefined)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return PaymentService;\r\n}());\r\nexports.default = PaymentService;\r\n","module.exports = require(\"aws-sdk\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(949);\n"],"sourceRoot":""}